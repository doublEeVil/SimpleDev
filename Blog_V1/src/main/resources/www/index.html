<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--========== The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags ==========-->
    <title>南风斜冷</title>

    <!--==========Dependency============-->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="vendors/owl-carousel/assets/owl.carousel.css">
    <link rel="stylesheet" href="vendors/magnific-popup/magnific-popup.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit:500">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:600,700italic">
    <link href='https://fonts.googleapis.com/css?family=Dosis:400,200,300,500,600,800,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:400,300,300italic,400italic">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500italic,500,700italic,700,900,900italic' rel='stylesheet' type='text/css'>

    <!--==========Theme Styles==========-->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/theme/green.css" rel="stylesheet">

    <!--========== HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries ==========-->
    <!--========== WARNING: Respond.js doesn't work if you view the page via file:// ==========-->
    <!--==========[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]==========-->
</head>
<body class="home">

<header class="row transparent white" data-spy="affix" data-offset-top="300" id="header">
    <div class="container">
        <div class="row top-header">
            <div class="col-sm-4 search-form-col">
                <form action="javascript:search()" method="post" class="search-form">
                    <div class="input-group">
                        <span class="input-group-addon"><img src="images/search-icon-dark.png" alt=""></span>
                        <input type="search" class="form-control" placeholder="SEARCH" id="keyword">
                    </div>
                </form>
            </div>
            <div class="col-sm-4 logo-col text-center">
                <a href="index.html"><img src="images/logo-black-green.png" alt=""></a>
            </div>
            <div class="col-sm-4 menu-trigger-col">
                <button class="menu-trigger black pull-right">
                    <span class="active-page">Details</span>
                    <img src="images/menu-align-dark.png" alt="" class="icon-burger">
                    <img src="images/menu-close-dark.png" alt="" class="icon-cross">
                </button>
            </div>
        </div>
    </div>
    <div class="row menu-section">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 menu-col">
                    <div class="row">
                        <ul class="nav column-menu white-bg">
                            <li><a href="about.html">About</a></li>
                            <!-- <li><a href="single.html">Blog Single 1</a></li>
                            <li><a href="single2.html">Blog Single 2</a></li> -->
                        </ul>
                        <ul class="nav column-menu white-bg">
                            <!-- <li><a href="single3.html">Blog Single 3</a></li> -->

                            <li><a href="contact.html">contact</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<section class="row content-wrap">
    <div class="container">
        <div class="row" id="post-masonry">
            <!--Blog Post-->

            <!---- --->
            <div id="app-4">
                <article class="col-sm-4 post post-masonry post-format-image" v-for="todo in todos">
                    <div class="post-wrapper row">
                        <div class="featured-content row">
                            <a :href=todo.url>
<!--                                <img :src=todo.imgurl alt="" class="img-responsive">-->
                            </a>
                        </div>
                        <div class="post-excerpt row">
                            <h5 class="post-meta">
                                <a href="#" class="date">{{ todo.date}}</a>
                                <span class="post-author"><i>by</i><a href="#">南风斜冷</a></span>
                            </h5>
                            <h3 class="post-title"><a :href=todo.url>{{ todo.title }}</a></h3>
<!--                            <p>{{ todo.content}}</p>-->
                        </div>
                    </div>
                </article>
            </div>
            <!---- --->

        </div>
    </div>
</section>

<div class="text-center">
    <ul class="pagination" id="pageNum">

        <li><a href="#">«</a></li> <!-- 上一页 -->

        <li class="active"><a href="#">1</a></li>

        <li><a href="#">2</a></li>

        <li><a href="#">3</a></li>

        <li><a href="#">4</a></li>

        <li><a href="#">5</a></li>

        <li><a href="#">»</a></li> <!-- 下一页 -->

    </ul>
</div>

<!--Footer-->
<footer class="row" id="footer">
    <div class="container">
        <div class="row top-footer">
            <div class="widget col-sm-3 widget-about">
                <div class="row m0"><a href="index.html"><img src="images/logo-black-green.png" alt=""></a></div>
            </div>
            <div class="widget col-sm-5 widget-menu">
                <div class="row">
                    <ul class="nav column-menu white-bg">
                        <li class="active"><a href="index.html">Home</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                    <ul class="nav column-menu white-bg">
                        <li><a href="contact.html">contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <h5 class="copyright">Copyright &copy; 2017.Company name All rights reserved.</h5>
        <hr>
            <div id='beian'>
                <a href='http://www.beian.miit.gov.cn'>【粤ICP备15077198号】</a>
            </div>
        <hr>
    </div>
</footer>

<!--========== jQuery (necessary for Bootstrap's JavaScript plugins) ==========-->
<script src="js/jquery-2.2.0.min.js"></script>
<script src="js/myutil.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript">


    var appData = new Vue({
        el: '#app-4',
        data: {
            todos:[
            {
                title: 'this is title 1',
                content: 'this is content1',
                url: 'http://baidu.com',
                date: new Date()
            }
            ]
        }
    });

    /**
     * 获得动态图，废弃
     */
    function getPic(num) {
        $.get("https://cn.bing.com/HPImageArchive.aspx?idx=0&n=" + num, function(data) {
            console.log(data);
        })
    }

    function search() {
        var keyword = document.getElementById('keyword').value;
        $.post("/api/search", {'keyword': keyword}, function(data) {
            dealData(data);
        });
    }

    function getIndex(page) {
        $.post("/api/index", {'page': page == null ? 1 : page}, function(data) {
            dealData(data);
        });
    }

    function dealData(data) {
        data = JSON.parse(data);
        //console.log(data);

        var title = data['title'];
        var pageNum = parseInt(data['pageNum']);
        var allSize = parseInt(data['allSize']);
        var pageSize = parseInt(data['pageSize']);
        var articleList = data['articleList'];

        var list = [];
        var article;

        for (var i = 0; i < articleList.length; i++) {
            article = articleList[i];
            var tmp = {};
            tmp.url = "single.html?articleId=" + article['articleId'];
            tmp.title = article.title;
            tmp.content = getContent(article.content, article.type);
            tmp.date = article.time;
            tmp.imgurl = "images/posts/masonry/" + getRandNum() + ".jpg";
            list[i] = tmp;
            //console.log(tmp);
        }
        
        appData.todos = list;

        // 设置标题
        document.title = title;
        // 设置页码开始
        var pageLineNode = document.getElementById('pageNum');
        var min = 1;
        var max = Math.ceil(allSize / pageSize);
        max = max < 1 ? 1 : max;
        max = max > 5 ? 5 : max;
        var inH = "";
        inH += "<li><a href='javascript:getIndex(" + (pageNum - 1) + ")'>«</a></li>";
        for(var i = min; i <= max; i++) {
            if(i == pageNum) {
                inH += "<li class='active'><a href='javascript:getIndex(" + i + ")'> " + i + " </a></li>";
            } else {
                inH += "<li><a href='javascript:getIndex(" + i + ")'> " + i + " </a></li>";
            }
        }
        inH += "<li><a href='javascript:getIndex(" + (pageNum + 1) + ")'>»</a></li>";
        pageLineNode.innerHTML = inH;
        // 设置页码结束
    }

    // 如果是搜索，处理搜索，否则进入主页
    var keyword = getQueryString('search_keyword');
    if(keyword) {
        $.post("/api/search", {'keyword': keyword}, function(data) {
            dealData(data);
        });
    } else {
        getIndex();
    }

    function getQueryString(name)
	{
	    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	    var r = window.location.search.substr(1).match(reg);
	    if(r!=null)return  decodeURIComponent(r[2]); return null;
	}

    function getRandNum() {
        return 1;
        // return parseInt(Math.random() * 4 + 1);
    }

    function getContent(content, type) {
        //console.log(content);
        if (type == 'markdown') {
            return marked(content);
        }
        if (type == 'html') {
            return content;
        }
    }

</script>
<script src="js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="vendors/owl-carousel/owl.carousel.min.js"></script>
<script src="vendors/magnific-popup/jquery.magnific-popup.min.js"></script>
<script src="vendors/instafeed/instafeed.min.js"></script>
<script src="vendors/imagesLoaded/imagesloaded.pkgd.min.js"></script>
<script src="vendors/isotope/isotope.pkgd.min.js"></script>
<script src="js/theme.js"></script>


</body>
</html>
